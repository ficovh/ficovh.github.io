<!DOCTYPE html>
<html lang="en">
<head>
          <title>BSDguy.org - Nginx - PHP-FPM - MySQL OpenBSD 5.6</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />




    <meta name="tags" content="nginx" />
    <meta name="tags" content="openbsd" />
    <meta name="tags" content="php" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">BSDguy.org</a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li class="active"><a href="./category/blog.html">blog</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./nginx-openbsd56.html" rel="bookmark"
         title="Permalink to Nginx - PHP-FPM - MySQL OpenBSD 5.6">Nginx - PHP-FPM - MySQL OpenBSD 5.6</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2015-04-04T00:00:00+02:00">
      Sat 04 April 2015
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="./author/francisco-valladolid.html">Francisco Valladolid</a>
    </address>
    <div class="category">
        Category: <a href="./category/blog.html">blog</a>
    </div>
    <div class="tags">
        Tags:
            <a href="./tag/nginx.html">nginx</a>
            <a href="./tag/openbsd.html">openbsd</a>
            <a href="./tag/php.html">php</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><strong>El siguiente articulo esta en Ingles y fue escrito por mi para www.vultr.com.</strong></p>
<p>OpenBSD is most used in firewall implementations,however, many people around the world are using OpenBSD as web server, mainly programmers and sysadmins.
We assume a knowledge of OpenBSD, nginx and Unix in general.</p>
<p>nginx [engine x] is an HTTP and reverse proxy server, as well as a mail proxy server, written by Igor Sysoev. For a long time, it has been running on many heavily loaded Russian sites . (<em>from the website</em>).</p>
<p>PHP-FPM (FastCGI Process Manager) is an alternative PHP FastCGI implementation with some additional features useful for sites of any size, especially busier sites. (<em>from the site</em>)</p>
<h3>Requeriments:</h3>
<ul>
<li>OpenBSD 5.6 installed in your vultr.com VPS</li>
<li>set the PKG_PATH = ftp://ftp.openbsd.org/pub/OpenBSD/5.6/packages/`arch -s`</li>
<li>super user access</li>
</ul>
<h2>Install nginx</h2>
<div class="highlight"><pre><span></span><code>$ sudo pkg_add -v nginx
Ambiguous: choose package <span class="k">for</span> nginx
a     <span class="m">0</span>: &lt;None&gt;
      <span class="m">1</span>: nginx-1.4.7p0
      <span class="m">2</span>: nginx-1.4.7p0-lua
      <span class="m">3</span>: nginx-1.4.7p0-naxsi
      <span class="m">4</span>: nginx-1.4.7p0-passenger
      <span class="m">5</span>: nginx-1.5.7p3
      <span class="m">6</span>: nginx-1.5.7p3-lua
      <span class="m">7</span>: nginx-1.5.7p3-naxsi
      <span class="m">8</span>: nginx-1.5.7p3-passenger
  Your choice:
</code></pre></div>

<p>For the purposes of this document, we install the "5" option.</p>
<h2>Install PHP-FPM</h2>
<p>$ sudo pkg_add -v php-fpm-5.5.14.tgz</p>
<p>The <em>/etc/rc.conf.local</em> must be containt the next line</p>
<p>nginx_flags=""</p>
<p>And the <em>/etc/rc.conf</em> for start automatically in each reboot.</p>
<div class="highlight"><pre><span></span><code># rc.d(8) packages scripts
# started in the specified order and stopped in reverse order
pkg_scripts=nginx
</code></pre></div>

<p><strong> Editing <em>/etc/nginx/nginx.conf</em> and <em>/etc/php-fpm.conf</em> </strong></p>
<p>Basic requeriments for /etc/nginx/nginx.conf in the <em>server</em> section.</p>
<div class="highlight"><pre><span></span><code><span class="nt">location</span> <span class="o">~</span> <span class="err">\</span><span class="p">.</span><span class="nc">php</span><span class="o">$</span> <span class="p">{</span>
            <span class="err">try_files</span> <span class="err">$uri</span> <span class="err">=404</span><span class="p">;</span>
            <span class="err">fastcgi_split_path_info</span> <span class="err">^(.+\.php)(/.+)$</span><span class="p">;</span>
            <span class="err">fastcgi_pass</span>   <span class="err">127.0.0.1:9000</span><span class="p">;</span>
            <span class="err">fastcgi_index</span> <span class="err">index.php</span><span class="p">;</span>
            <span class="err">fastcgi_param</span>  <span class="err">SCRIPT_FILENAME</span> <span class="err">$document_root$fastcgi_script_name</span><span class="p">;</span>
            <span class="err">include</span> <span class="err">fastcgi_params</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>

<p><strong>Edit /etc/php-fpm.conf</strong></p>
<div class="highlight"><pre><span></span><code><span class="o">;</span> <span class="nt">Unix</span> <span class="nt">user</span><span class="o">/</span><span class="nt">group</span> <span class="nt">of</span> <span class="nt">processes</span>
<span class="o">;</span> <span class="nt">Note</span><span class="o">:</span> <span class="nt">The</span> <span class="nt">user</span> <span class="nt">is</span> <span class="nt">mandatory</span><span class="o">.</span> <span class="nt">If</span> <span class="nt">the</span> <span class="nt">group</span> <span class="nt">is</span> <span class="nt">not</span> <span class="nt">set</span><span class="o">,</span> <span class="nt">the</span> <span class="nt">default</span> <span class="nt">user</span><span class="s1">&#39;s </span>
<span class="s1">; group will be used.</span>
<span class="s1">user = www</span>
<span class="s1">group = www</span>


<span class="s1">; The address on which to accept FastCGI requests.</span>
<span class="s1">; Valid syntaxes are:</span>
<span class="s1">; &#39;</span><span class="nt">ip</span><span class="p">.</span><span class="nc">add</span><span class="p">.</span><span class="nc">re</span><span class="p">.</span><span class="nc">ss</span><span class="p">:</span><span class="nd">port</span><span class="s1">&#39;    - to listen on a TCP socket to a specific address on</span>
<span class="s1">;                            a specific port;</span>
<span class="s1">;   &#39;</span><span class="nt">port</span><span class="s1">&#39;                 - to listen on a TCP socket to all addresses on a</span>
<span class="s1">;                            specific port;</span>
<span class="s1">;   &#39;</span><span class="o">/</span><span class="nt">path</span><span class="o">/</span><span class="nt">to</span><span class="o">/</span><span class="nt">unix</span><span class="o">/</span><span class="nt">socket</span><span class="err">&#39;</span> <span class="nt">-</span> <span class="nt">to</span> <span class="nt">listen</span> <span class="nt">on</span> <span class="nt">a</span> <span class="nt">unix</span> <span class="nt">socket</span><span class="o">.</span>
<span class="o">;</span> <span class="nt">Note</span><span class="o">:</span> <span class="nt">This</span> <span class="nt">value</span> <span class="nt">is</span> <span class="nt">mandatory</span><span class="o">.</span>

<span class="nt">listen</span> <span class="o">=</span> <span class="nt">127</span><span class="p">.</span><span class="nc">0</span><span class="p">.</span><span class="nc">0</span><span class="p">.</span><span class="nc">1</span><span class="p">:</span><span class="nd">9000</span>
</code></pre></div>

<h2>Installing MySQL</h2>
<div class="highlight"><pre><span></span><code>$ sudo pkg_add -v mysql-server-5.1.73p0v0.tgz

Update candidates: quirks-2.9 -&gt; quirks-2.9 <span class="o">(</span>ok<span class="o">)</span>
quirks-2.9 signed on <span class="m">2014</span>-07-31T22:37:55Z
mysql-server-5.1.73p0v0:p5-Net-Daemon-0.48: ok
mysql-server-5.1.73p0v0:p5-PlRPC-0.2018p1: ok
mysql-server-5.1.73p0v0:p5-Clone-0.36p0: ok
mysql-server-5.1.73p0v0:p5-Params-Util-1.07p0: ok
mysql-server-5.1.73p0v0:p5-SQL-Statement-1.405: ok
mysql-server-5.1.73p0v0:p5-FreezeThaw-0.5001: ok
mysql-server-5.1.73p0v0:p5-MLDBM-2.05: ok
mysql-server-5.1.73p0v0:p5-DBI-1.631p0: ok
mysql-server-5.1.73p0v0:mysql-client-5.1.73v0: ok
mysql-server-5.1.73p0v0:p5-DBD-mysql-4.027: ok
mysql-server-5.1.73p0v0: ok
The following new rcscripts were installed: /etc/rc.d/mysqld
See rc.d<span class="o">(</span><span class="m">8</span><span class="o">)</span> <span class="k">for</span> details.
Look <span class="k">in</span> /usr/local/share/doc/pkg-readmes <span class="k">for</span> extra documentation.
Extracted <span class="m">39040357</span> from <span class="m">39044890</span>
</code></pre></div>

<h3>Initial setup</h3>
<p>Later to install MySQL you need setup this.</p>
<p>Create the initial database:</p>
<div class="highlight"><pre><span></span><code>$ sudo /usr/local/bin/mysql_install_db
</code></pre></div>

<p>You can run the <code>/usr/local/bin/mysql_secure_installation</code> script for optimize your mysql installation or 
set the root password directly with the next command.</p>
<div class="highlight"><pre><span></span><code>$ sudo /usr/local/bin/mysqladmin -u root password <span class="s1">&#39;password&#39;</span>
</code></pre></div>

<p>And execute mysql as root for administrations tasks only, you can create databases and users.</p>
<div class="highlight"><pre><span></span><code>$ mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
Your MySQL connection id is <span class="m">47</span>
Server version: <span class="m">5</span>.1.73-log OpenBSD port: mysql-server-5.1.73p0v0

Copyright <span class="o">(</span>c<span class="o">)</span> <span class="m">2000</span>, <span class="m">2013</span>, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.

mysql&gt;
</code></pre></div>

<h3>MySQL support for PHP</h3>
<div class="highlight"><pre><span></span><code>$ sudo pkg_add -v php-pdo_mysql-5.5.14.tgz
</code></pre></div>

<h2>Starting daemons</h2>
<div class="highlight"><pre><span></span><code>$ sudo /etc/rc.d/nginx start
$ sudo /etc/rc.d/php-fpm start
$ sudo /etc/rc.d/mysqld start
</code></pre></div>

<p>You can write a basic <code>info.php</code> file into documentroot, in my case, /var/www/htdocs/example.com</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nb">phpinfo</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div>

<p>if all is ok, then you can view the PHP information web page.</p>
<h2>Logs</h2>
<p>Basic log files are found in <code>/var/log/nginx</code> subdirectory for audit purposes.</p>
<p>Enjoy.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>